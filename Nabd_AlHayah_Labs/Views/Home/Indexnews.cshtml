@model IEnumerable<Nabd_AlHayah_Labs.Model.NewsEvent>
@{
    ViewData["Title"] = "News & Events";
}

<style>
    .notification-badge {
        position: absolute;
        top: 8px;
        right: 8px;
        width: 28px;
        height: 28px;
        background: linear-gradient(135deg, #28a745, #218838);
        color: #fff;
        font-weight: bold;
        font-size: 0.9rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        z-index: 10;
    }

    .app-card-thumb img.thumb-image {
        width: 100%;
        height: 160px;
        object-fit: cover;
        border-radius: 0.25rem;
    }
</style>

<div class="row g-3 mb-4 align-items-center justify-content-between">
    <div class="col-auto">
        <h1 class="app-page-title mb-0">News & Events</h1>
    </div>
    <div class="col-auto">
        <a asp-action="Create" class="btn app-btn-primary">
            <i class="fas fa-plus me-2"></i>Add New
        </a>
    </div>
</div>

<div class="row g-4">
    @foreach (var item in Model)
    {
        <div class="col-6 col-md-4 col-xl-3">
            <div class="app-card app-card-doc shadow-sm h-100 position-relative">

                <!-- Badge للإشعارات (مثلاً عدد التعليقات أو المهمات) -->
                <span class="notification-badge">@item.Id</span>

                <div class="app-card-thumb-holder p-3">
                    <div class="app-card-thumb">
                        @if (item.Image != null && item.Image.Length > 0)
                        {
                            var base64 = Convert.ToBase64String(item.Image);
                            var imgSrc = $"data:image/png;base64,{base64}";
                            <img class="thumb-image" src="@imgSrc" alt="@item.TitleAr" />
                        }
                        else if (!string.IsNullOrEmpty(item.ImageUrl))
                        {
                            <img class="thumb-image" src="@item.ImageUrl" alt="@item.TitleAr" />
                        }
                        else
                        {
                            <img class="thumb-image" src="~/assets/images/default-image.jpg" alt="No Image" />
                        }
                    </div>
                    <a asp-action="Details" asp-route-id="@item.Id" class="app-card-link-mask"></a>
                </div>

                <div class="app-card-body p-3 has-card-actions">
                    <h4 class="app-doc-title truncate mb-1">
                        <a asp-action="Details" asp-route-id="@item.Id">@item.TitleAr</a>
                    </h4>
                    <div class="text-muted small mb-2">
                        <i class="fas fa-calendar-alt me-1"></i>
                        @item.EventDate?.ToString("dd/MM/yyyy")
                    </div>
                    <p class="text-truncate mb-2">
                        @item.DescriptionAr
                    </p>

                    <div class="app-card-actions">
                        <div class="dropdown">
                            <div class="dropdown-toggle no-toggle-arrow" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-three-dots-vertical"></i>
                            </div>
                            <ul class="dropdown-menu">
                                <li>
                                    <a class="dropdown-item" asp-action="Details" asp-route-id="@item.Id">
                                        <i class="bi bi-eye me-2"></i>Details
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" asp-action="Edit" asp-route-id="@item.Id">
                                        <i class="bi bi-pencil me-2"></i>Edit
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item text-danger" asp-action="Delete" asp-route-id="@item.Id">
                                        <i class="bi bi-trash me-2"></i>Delete
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div><!--//app-card-body-->
            </div><!--//app-card-->
        </div>

        <!--//col-->
    }
</div><!--//row-->
@if (!Model.Any())
{
    <div class="alert alert-info text-center mt-5">
        No news or events available.
    </div>
}
